app.factory("playerService",["envService","$location",function(e){var t={speeds:[3,2.5,2,1.6,1.3,1,.8,.6],speeds_index:5,transition_type:"linear"};t.updateAnimationStyle=function(e,r){var n="linear"==t.transition_type?"linear":"cubic-bezier(.5,0,.5,1)";t.transition_style_string="top "+t.speeds[t.speeds_index]+"s "+n+",left "+t.speeds[t.speeds_index]+"s "+n+",box-shadow "+t.speeds[t.speeds_index]+"s "+n+",background-color "+"0.5s "+n+",transform 0.7s linear";for(var a=0;e.length>a;a++)e[a].transitionTo(r.current_frame_index)},t.toggleTransitionType=function(e,r){t.transition_type="linear"==t.transition_type?"cubic":"linear",t.updateAnimationStyle(e,r)},t.changeSpeed=function(e,r,n){"up"==n?t.speeds.length-1>t.speeds_index&&t.speeds_index++:t.speeds_index>0&&t.speeds_index--,t.updateAnimationStyle(e,r)};var r=function(r,n,a,s,i){this.top=28*n+"px",this.left=28*r+"px",this["background-color"]=a,this["box-shadow"]=s?"0px 0px 30px 15px "+a:"none",this.transition=t.transition_style_string,i!==void 0&&(this["background-image"]="url('./images/"+i+".png')"),this.transform="rotateZ("+90*e.ball_rotation[e.current_3d_index]+"deg)"};t.GeneratedStyle=r;var n=function(t){if("ball"==this.jersey_number)var n=e.current_sport;else var n=void 0;this.current_style=new r(this.frames[t].posX,this.frames[t].posY,this.default_color,this.frames[t].highlighted,n)},a=function(e,t,r,a){this.default_color=e,this.jersey_number=t,this.default_shadow="none",this.current_style=r,this.frames=a,this.transitionTo=n};return t.decompressPlay=function(e,r,n,a){var s=e.input_play.indexOf("_"),i=e.input_play.substring(0,s);e.team1_temp_color_index=i.substring(0,3),e.team2_temp_color_index=i.substring(3);var o=[r[parseInt(i.substring(0,3))],r[parseInt(i.substring(3))]];e.team1_temp_color=o[0],e.team2_temp_color=o[1],e.input_play=e.input_play.substring(s+1);for(var l=[];e.input_play.length>0;){var p=e.input_play.indexOf("_")>0?e.input_play.indexOf("_"):e.input_play.length;l.push(e.input_play.substring(0,p)),e.input_play=-1!=e.input_play.indexOf("_")?e.input_play.substring(p+1):""}for(var d=0;l.length>d;d++)n.push(this.decompressPlayer(l[d],d,o,e));e.frames=[];for(var d=0;n[0].frames.length>d;d++)e.frames.push(d);ball_style=n[n.length-1].current_style,n[n.length-1].jersey_number="ball",n[n.length-1].default_color="transparent",e.toggleSelected(n[n.length-1]),e.updateSelectedPlayer(t),e.toggleSelected(n[n.length-1]);for(d in e.ball_style)ball_style[d]=e.ball_style[d];t.updateAnimationStyle(n,e),a.goToFrame(0,this,n,e)},t.decompressPlayer=function(e,t,n,s){for(var i=[],o=[],l=0;e.length>0;){var p=e.substring(0,2);i.push(p),e=e.substring(2)||""}for(var d=0;i.length>d;d++){var _=45*s.conversion_array.indexOf(i[d][0])+s.conversion_array.indexOf(i[d][1]),m=!1;_>1478?(_-=1479,l=1,m=!0):_>985?(_-=986,l=1):_>492&&(_-=493,m=!0);var u=Math.floor(_/29),c=_%29;o.push({posX:c,posY:u,highlighted:m})}player_color=n[l];var h=new r(o[0].posX,o[0].posY,player_color,o[0].highlighted);return decompressed_player=new a(player_color,t,h,o)},t.compressPlay=function(e,t){for(var r=""+e.team1_temp_color_index+e.team2_temp_color_index,n=0;t.length>n;n++){r+="_";var a=t[n].default_color==e.team1_temp_color?1:2;for(j=0;t[n].frames.length>j;j++)r+=this.compressFrame(e.conversion_array,t[n].frames[j],a)}e.play_data_model=r},t.compressFrame=function(e,t,r){var n=29*t.posY+parseInt(t.posX),a=0;return 1==t.highlighted&&1==r?a=493:0==t.highlighted&&2==r?a=986:1==t.highlighted&&2==r&&(a=1479),n+=a,compressed_frame1=e[Math.floor(n/45)],compressed_frame2=e[n%45],compressed_frame=compressed_frame1+compressed_frame2},t.newPlay=function(e,t,r){r.length=0,e.selected_player=null,e.frames.length=0,e.current_frame_index=0;var n=e.team1_temp_color.toLowerCase(),a=e.team2_temp_color.toLowerCase();-1!=t.indexOf(n)?e.team1_temp_color_index=e.addZeroPadding(t.indexOf(n)):(e.randomize(1,t),e.team1_temp_color_index=e.addZeroPadding(t.indexOf(e.team1_temp_color))),-1!=t.indexOf(a)?e.team2_temp_color_index=e.addZeroPadding(t.indexOf(a)):(e.randomize(2,t),e.team2_temp_color_index=e.addZeroPadding(t.indexOf(e.team2_temp_color))),e.modal_visible=!1;for(var s=0;e.frames_input_validated>s;s++)e.frames.push(s);for(s=0;e.team1_preview.length>s;s++)this.add(e,e.team1_temp_color,e.default_positions1[s],s,r);for(s=0;e.team2_preview.length>s;s++)this.add(e,e.team2_temp_color,e.default_positions2[s],s+e.team1_preview.length,r);this.add(e,"aqua",[14,8],"ball",r),e.mode="create",e.save(this,r)},t.add=function(e,t,n,s,i){for(var o=[],l=0;e.frames_input_validated>l;l++)o.push({posX:n[0],posY:n[1],highlighted:!1});var p=new r(n[0],n[1],t,!1);"ball"==s&&(p["background-color"]="none",p["background-image"]="url('./images/"+e.current_sport+".png')"),i.push(new a(t,s,p,o))},t}]);